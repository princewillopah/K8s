apiVersion: v1
kind: Pod
metadata:
  name: demo-pod-pvc
  labels:
    app: demo
spec:
  volumes:
  - name: shared-data
    persistentVolumeClaim:
      claimName: shared-pvc

  initContainers:
  - name: init-file-writer
    image: busybox
    command: ['sh', '-c', 'echo "<h1>Persistent HTML from Init</h1>" > /data/index.html']
    volumeMounts:
    - name: shared-data
      mountPath: /data

  containers:
  - name: nginx-server-x
    image: nginx
    ports:
    - containerPort: 80
    volumeMounts:
    - name: shared-data
      mountPath: /usr/share/nginx/html

  - name: sidecar-logger
    image: busybox
    command: ['sh', '-c', 'while true; do echo "$(date) sidecar log entry" >> /data/logs.txt; sleep 5; done']
    volumeMounts:
    - name: shared-data
      mountPath: /data
